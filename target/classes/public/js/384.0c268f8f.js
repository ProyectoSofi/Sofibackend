"use strict";(self["webpackChunkmockups"]=self["webpackChunkmockups"]||[]).push([[384],{4728:(e,l,a)=>{a.r(l),a.d(l,{default:()=>De});var o=a(3673),t=a(7786),n=a(2323),i=a(1959),u=a(6665),c=a(4417),d=a(5826),s=a(1289),r=a(4826),p=a(4913),m=a(4842),v=a(8825),f=a(8251),b=a(3787),h=a(765),y=a(1214),w=a(7536);class _{constructor({id:e,detalles:l,fecha:a,fechaVencimiento:o,tipoPago:t,total:n,clienteID:i,clienteNombre:u,costoTotal:c,totalItems:d,totalServicios:s}){this.id=e||"",this.detalles=l||[],this.fecha=a||(0,w.l)(),this.fechaVencimiento=o||(0,w.l)(),this.clienteID=i||"",this.clienteNombre=u||"",this.tipoPago=t||"",this.total=n||0,this.costoTotal=c||0,this.totalItems=d||0,this.totalServicios=s||0}}var g=a(1185),Z=a(852),V=a(7831),I=a(2946);const U=(0,I.r)(),N=(0,V.Q_)("devolucion",{state:()=>({devolucionesByID:{}}),getters:{},actions:{validateDevolucion(e){const l=[];return""==e.clienteID&&l.push("Debe seleccionar un cliente"),""==e.tipoPago&&l.push("Debe seleccionar un tipo de pago"),l.length>0||e.detalles.forEach((e=>{const a=U.get(e.codigo);a&&e.cantidad>a.cantidad&&l.push(`No hay suficiente ${a.descripcion}, quedan ${a.cantidad}${a.unidadPreferida}`)})),l},registerDevolucion(e){this.devolucionesByID[e.id]=e,e.detalles.forEach((e=>{U.affect(e.codigo,(l=>{if(l)return l.cantidad-=e.cantidad,l.costeTotal-=l.costeUnitario*e.cantidad,l}))}))},findByID(e){return[this.devolucionesByID[e]]},findByCliente(e){return Object.values(this.devolucionesByID).filter((l=>l.clienteID.startsWith(e)))},findByFecha(e){return Object.values(this.devolucionesByID).filter((l=>l.fecha==e))}},persist:!0});var D=a(1186),W=a(8344);const S=e=>((0,o.dD)("data-v-514b8b5a"),e=e(),(0,o.Cn)(),e),k={class:"row items-center"},M=S((()=>(0,o._)("span",{class:"titulo-pagina"},"Devolucion",-1))),C={class:"comprobante"},T=S((()=>(0,o._)("br",null,null,-1))),q=S((()=>(0,o._)("br",null,null,-1))),E=S((()=>(0,o._)("br",null,null,-1))),R={class:"col-auto row items-end justify-end relative-position"},B={class:"col-auto q-pa-sm item-bordered shadow-2 total"},P=S((()=>(0,o._)("br",null,null,-1))),Q={class:"row items-center justify-end"},j={class:"row items-center justify-end"},$=S((()=>(0,o._)("br",null,null,-1))),H=S((()=>(0,o._)("br",null,null,-1))),x={class:"shadow-2 total bg-white full-width text-center"},z=(0,o.aZ)({setup(e){const l=(0,v.Z)(),a=(0,i.iH)(0),t=(0,i.iH)(null),w=N(),V=(0,i.iH)(new _({id:(0,g.Z)()})),I=(0,i.iH)([{label:"",value:""}]),U=(0,i.iH)(""),S=[{field:"item",label:"Item",type:h.N.STRING},{field:"codigo",label:"Codigo",type:h.N.NUMBER},{field:"precio",label:"Precio",responsive:!0,type:h.N.NUMBER,formatter:b.M,prefix:"$"},{field:"descuento",label:"Descuento",type:h.N.NUMBER},{field:"impuesto",label:"Impuesto",type:h.N.NUMBER,formatter:e=>`${e}%`},{field:"cantidad",label:"Cantidad",responsive:!0,type:h.N.NUMBER,formatter:b.M},{field:"total",label:"Total",type:h.N.NUMBER,formatter:b.M,prefix:"$"}],z=(0,i.iH)(new y.f({})),O=(0,i.iH)("ITEM");function Y(){l.dialog({component:p.Z}).onOk((e=>{switch(z.value=e,O.value=e.type,e.type){case"ITEM":I.value=Object.entries(f.M.instance().getUnits(e.dimension)).map((e=>({label:e[1].symbol,value:e[0]})));const l=f.M.instance().dimensions[e.dimension].baseUnit;U.value=f.M.instance().getUnits(e.dimension)[l].symbol;break}setTimeout((()=>{t.value.focus(),t.value.select()}),100)}))}function F(){l.dialog({component:Z.Z}).onOk((e=>{e.clienteID?V.value.clienteID=e.clienteID:V.value.clienteID=e.proveedorID,V.value.clienteNombre=e.nombre}))}const G=(0,i.iH)(0),A=(0,i.iH)(0),L=(0,i.iH)("%");function J(){let e="0%",l=z.value.precio*G.value;if(0!==A.value&&("%"===L.value?(l-=l*(A.value/100),e=`${A.value}%`):(l-=A.value,e=`$${A.value}`)),"ITEM"===z.value.type){let a=z.value;V.value.detalles.push({codigo:a.codigo,item:a.descripcion,impuesto:a.impuesto,precio:a.precio,costo:a.costeUnitario,descuento:e,cantidad:G.value,total:l,costoTotal:a.costeUnitario*G.value,type:"ITEM"})}else{let a=z.value;V.value.detalles.push({codigo:a.codigo,item:a.descripcion,impuesto:a.impuesto,precio:a.precio,costo:0,descuento:e,cantidad:G.value,total:l,costoTotal:0,type:"SERVICIO"})}z.value=new y.f({}),G.value=0,A.value=0}const K=(0,o.Fl)((()=>{let e=0;return V.value.detalles.forEach((l=>{e+=l.total})),e})),X=(0,i.iH)(!0);function ee(e){X.value=e.isIntersecting}const le=(0,i.iH)("");function ae(){V.value=new _({}),z.value=new y.f({}),G.value=0,A.value=0,le.value=""}function oe(){let e=0,a=0,o=0;for(const l of V.value.detalles)switch(e+=l.costoTotal?l.costoTotal:0,l.type){case"ITEM":a+=l.total;break;case"SERVICIO":o+=l.total;break}V.value.costoTotal=e,V.value.total=K.value,V.value.totalItems=a,V.value.totalServicios=o;const t=w.validateDevolucion(V.value);if(t.length>0)t.forEach((e=>{l.notify(e)}));else try{w.registerDevolucion(V.value);W.Q.post("/devolucion",V.value);V.value=new _({id:(0,g.Z)()}),l.notify("Devolucion guardada exitosamente")}catch(n){console.log(n)}}return(e,p)=>{const v=(0,o.up)("q-space"),f=(0,o.up)("q-select"),h=(0,o.up)("q-btn"),y=(0,o.up)("q-resize-observer"),w=(0,o.up)("q-date"),_=(0,o.up)("q-popup-proxy"),g=(0,o.up)("q-icon"),Z=(0,o.up)("q-card-section"),N=(0,o.up)("q-card"),W=(0,o.up)("q-page-sticky"),le=(0,o.Q2)("intersection"),te=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(N,{flat:""},{default:(0,o.w5)((()=>[(0,o.Wm)(Z,{style:(0,n.j5)({"padding-bottom":a.value+"px"})},{default:(0,o.w5)((()=>[(0,o._)("div",k,[M,(0,o.Wm)(v),(0,o._)("span",C,"ID Devolucion: "+(0,n.zw)(V.value.id),1)]),T,(0,o.Wm)(c.Z,null,{action:(0,o.w5)((()=>[(0,o.Wm)(D.Z,{"help-key":"devolucion:agregarItem"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"advance-btn",label:"Agregar item",onClick:J})])),_:1})])),default:(0,o.w5)((()=>[(0,o.Wm)(r.Z,{"help-key":"devolucion:item"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{modelValue:z.value.descripcion,"onUpdate:modelValue":p[0]||(p[0]=e=>z.value.descripcion=e),label:"Item",readonly:"",onClick:Y},null,8,["modelValue"])])),_:1}),(0,o.Wm)(r.Z,{"help-key":"devolucion:cantidad"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{ref_key:"cantidadHTML",ref:t,modelValue:G.value,"onUpdate:modelValue":p[2]||(p[2]=e=>G.value=e),modelModifiers:{number:!0},label:"Cantidad",placeholder:"Ingrese cantidad",type:"number"},{append:(0,o.w5)((()=>["ITEM"==O.value?((0,o.wg)(),(0,o.j4)(f,{key:0,modelValue:U.value,"onUpdate:modelValue":p[1]||(p[1]=e=>U.value=e),options:I.value,"emit-value":"","map-options":""},null,8,["modelValue","options"])):(0,o.kq)("",!0)])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(r.Z,{"help-key":"devolucion:descuento"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{modelValue:A.value,"onUpdate:modelValue":p[4]||(p[4]=e=>A.value=e),label:"Descuento",placeholder:"Ingrese descuento"},{append:(0,o.w5)((()=>[(0,o.Wm)(f,{modelValue:L.value,"onUpdate:modelValue":p[3]||(p[3]=e=>L.value=e),options:["%","$"]},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),q,(0,o.Wm)(s.Z,{actions:[{icon:"delete",onClick:(e,l)=>{V.value.detalles.splice(l,1)},class:"revert-btn"}],data:V.value.detalles,schema:S,title:"Items"},null,8,["actions","data"]),E,(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",R,[(0,i.SU)(l).platform.is.mobile?((0,o.wg)(),(0,o.j4)(y,{key:0,onResize:p[5]||(p[5]=({height:e})=>{a.value=e})})):(0,o.kq)("",!0),(0,o._)("span",B,[(0,o._)("b",null,"Total devolucion: $"+(0,n.zw)((0,i.SU)(b.M)((0,i.SU)(K))),1)])])),[[le,ee]]),P,(0,o.Wm)(c.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r.Z,{"help-key":"devolucion:fecha"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{modelValue:V.value.fecha,"onUpdate:modelValue":p[7]||(p[7]=e=>V.value.fecha=e),label:"Fecha"},{append:(0,o.w5)((()=>[(0,o.Wm)(g,{class:"cursor-pointer",name:"event"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{ref:"qDateProxy",cover:"","transition-hide":"scale","transition-show":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{modelValue:V.value.fecha,"onUpdate:modelValue":p[6]||(p[6]=e=>V.value.fecha=e),mask:"DD/MM/YYYY"},{default:(0,o.w5)((()=>[(0,o._)("div",Q,[(0,o.wy)((0,o.Wm)(h,{color:"primary",flat:"",label:"Close"},null,512),[[te]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(r.Z,{"help-key":"devolucion:fechaVencimiento"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{modelValue:V.value.fechaVencimiento,"onUpdate:modelValue":p[9]||(p[9]=e=>V.value.fechaVencimiento=e),label:"Fecha Vencimiento"},{append:(0,o.w5)((()=>[(0,o.Wm)(g,{class:"cursor-pointer",name:"event"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{ref:"qDateProxy",cover:"","transition-hide":"scale","transition-show":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{modelValue:V.value.fechaVencimiento,"onUpdate:modelValue":p[8]||(p[8]=e=>V.value.fechaVencimiento=e),mask:"DD/MM/YYYY"},{default:(0,o.w5)((()=>[(0,o._)("div",j,[(0,o.wy)((0,o.Wm)(h,{color:"primary",flat:"",label:"Close"},null,512),[[te]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),$,(0,o.Wm)(c.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r.Z,{"help-key":"devolucion:terceroID"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{label:"Nit/CC",modelValue:V.value.clienteID,"onUpdate:modelValue":p[10]||(p[10]=e=>V.value.clienteID=e),readonly:"",onClick:F},null,8,["modelValue"])])),_:1}),(0,o.Wm)(r.Z,{"help-key":"devolucion:nombre"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{label:"Nombre",modelValue:V.value.clienteNombre,"onUpdate:modelValue":p[11]||(p[11]=e=>V.value.clienteNombre=e),readonly:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(r.Z,{"help-key":"devolucion:tipoPago"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{label:"Tipo Pago",modelValue:V.value.tipoPago,"onUpdate:modelValue":p[12]||(p[12]=e=>V.value.tipoPago=e),options:["Efectivo","Credito"]},null,8,["modelValue"])])),_:1})])),_:1}),H,(0,o.Wm)(d.Z,{btns:[{label:"Cancelar",fn:()=>{(0,i.SU)(l).dialog({component:u.Z,componentProps:{mensaje:"Â¿Seguro que quieres cancelar?"}}).onOk((a=>{e.x,(0,i.SU)(l).notify("Devolucion cancelada"),ae()})).onCancel((()=>{(0,i.SU)(l).notify("Cancelado")}))},class:"revert-btn shadow-10"},{label:"Guardar",fn:oe}]},null,8,["btns"])])),_:1},8,["style"])])),_:1}),X.value?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(W,{key:0,expand:"",position:"bottom"},{default:(0,o.w5)((()=>[(0,o._)("span",x,[(0,o._)("b",null,"Total devolucion: $"+(0,n.zw)((0,i.SU)(b.M)((0,i.SU)(K))),1)])])),_:1}))],64)}}});var O=a(4260),Y=a(151),F=a(5589),G=a(2025),A=a(3017),L=a(8240),J=a(5151),K=a(4554),X=a(3944),ee=a(6915),le=a(1007),ae=a(5094),oe=a(677),te=a(7518),ne=a.n(te);const ie=(0,O.Z)(z,[["__scopeId","data-v-514b8b5a"]]),ue=ie;ne()(z,"components",{QCard:Y.Z,QCardSection:F.Z,QSpace:G.Z,QInput:m.Z,QSelect:A.Z,QBtn:L.Z,QResizeObserver:J.Z,QIcon:K.Z,QPopupProxy:X.Z,QDate:ee.Z,QPageSticky:le.Z}),ne()(z,"directives",{Intersection:ae.Z,ClosePopup:oe.Z});var ce=a(1716);const de=e=>((0,o.dD)("data-v-5b058cbc"),e=e(),(0,o.Cn)(),e),se=de((()=>(0,o._)("span",{class:"titulo-pagina"},"Devolucion de venta",-1))),re={class:"comprobante"},pe=de((()=>(0,o._)("br",null,null,-1))),me=de((()=>(0,o._)("br",null,null,-1))),ve={class:"col-auto row items-end justify-end relative-position"},fe={class:"col-auto q-pa-sm item-bordered shadow-2 total"},be=de((()=>(0,o._)("br",null,null,-1))),he=de((()=>(0,o._)("br",null,null,-1))),ye=(0,o.aZ)({props:{devolucion:null},setup(e){const l=(0,v.Z)(),a=(0,i.iH)(0),t=[{field:"item",label:"Item",type:h.N.STRING},{field:"codigo",label:"Codigo",type:h.N.NUMBER},{field:"precio",label:"Precio",responsive:!0,type:h.N.NUMBER,formatter:b.M,prefix:"$"},{field:"descuento",label:"Descuento",type:h.N.NUMBER},{field:"impuesto",label:"Impuesto",type:h.N.NUMBER,formatter:e=>`${e}%`},{field:"cantidad",label:"Cantidad",responsive:!0,type:h.N.NUMBER,formatter:b.M},{field:"total",label:"Total",type:h.N.NUMBER,formatter:b.M,prefix:"$"}];return(u,d)=>{const r=(0,o.up)("q-space"),p=(0,o.up)("q-resize-observer"),v=(0,o.up)("q-card-section"),f=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(f,{flat:""},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o._)("div",{style:(0,n.j5)({"padding-top":a.value+"px"}),class:"row items-center"},[se,(0,o.Wm)(r),(0,o._)("span",re,"ID Devolucion: "+(0,n.zw)(e.devolucion.id),1)],4),pe,(0,o.Wm)(s.Z,{data:e.devolucion.detalles,schema:t,title:"Items"},null,8,["data"]),me,(0,o._)("div",ve,[(0,i.SU)(l).platform.is.mobile?((0,o.wg)(),(0,o.j4)(p,{key:0,onResize:d[0]||(d[0]=({height:e})=>{a.value=e})})):(0,o.kq)("",!0),(0,o._)("span",fe,[(0,o._)("b",null,"Total devolucion: $"+(0,n.zw)((0,i.SU)(b.M)(e.devolucion.total)),1)])]),be,(0,o.Wm)(c.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{modelValue:e.devolucion.fecha,"onUpdate:modelValue":d[1]||(d[1]=l=>e.devolucion.fecha=l),label:"Fecha",readonly:""},null,8,["modelValue"]),(0,o.Wm)((0,i.SU)(m.Z),{modelValue:e.devolucion.fechaVencimiento,"onUpdate:modelValue":d[2]||(d[2]=l=>e.devolucion.fechaVencimiento=l),label:"Fecha Vencimiento",readonly:""},null,8,["modelValue"])])),_:1}),he,(0,o.Wm)(c.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,i.SU)(m.Z),{label:"Nit/CC",modelValue:e.devolucion.clienteID,"onUpdate:modelValue":d[3]||(d[3]=l=>e.devolucion.clienteID=l),readonly:""},null,8,["modelValue"]),(0,o.Wm)((0,i.SU)(m.Z),{label:"Nombre",modelValue:e.devolucion.clienteNombre,"onUpdate:modelValue":d[4]||(d[4]=l=>e.devolucion.clienteNombre=l),readonly:""},null,8,["modelValue"]),(0,o.Wm)((0,i.SU)(m.Z),{label:"Tipo Pago",modelValue:e.devolucion.tipoPago,"onUpdate:modelValue":d[5]||(d[5]=l=>e.devolucion.tipoPago=l),readonly:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})}}}),we=(0,O.Z)(ye,[["__scopeId","data-v-5b058cbc"]]),_e=we;ne()(ye,"components",{QCard:Y.Z,QCardSection:F.Z,QSpace:G.Z,QResizeObserver:J.Z,QInput:m.Z});const ge=(0,o.aZ)({setup(e){const l=N(),a=(0,i.iH)(void 0);function t(e){a.value=e}const n=[{field:"id",label:"ID",responsive:!0,type:h.N.STRING},{field:"fecha",label:"Fecha",responsive:!0,type:h.N.STRING},{field:"clienteID",label:"Nit/CC",responsive:!0,type:h.N.STRING},{field:"tipoPago",label:"Tipo de pago",responsive:!0,type:h.N.STRING},{field:"total",label:"Total",responsive:!0,type:h.N.NUMBER,formatter:b.M,prefix:"$"}];return(e,u)=>((0,o.wg)(),(0,o.j4)(ce.Z,{store:(0,i.SU)(l),schema:n,onSelected:t},{default:(0,o.w5)((()=>[a.value?((0,o.wg)(),(0,o.j4)(_e,{key:0,factura:a.value},null,8,["factura"])):(0,o.kq)("",!0)])),_:1},8,["store"]))}}),Ze=(0,O.Z)(ge,[["__scopeId","data-v-e4ea2298"]]),Ve=Ze,Ie=(0,o.aZ)({setup(e){return(e,l)=>{const a=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(a,{class:"column q-ml-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(t.Z,{tabs:["Crear","Buscar"]},{Crear:(0,o.w5)((()=>[(0,o.Wm)(ue)])),Buscar:(0,o.w5)((()=>[(0,o.Wm)(Ve)])),_:1})])),_:1})}}});var Ue=a(4379);const Ne=(0,O.Z)(Ie,[["__scopeId","data-v-36296204"]]),De=Ne;ne()(Ie,"components",{QPage:Ue.Z})}}]);