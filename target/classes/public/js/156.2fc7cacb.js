"use strict";(self["webpackChunkmockups"]=self["webpackChunkmockups"]||[]).push([[156],{9407:(e,a,l)=>{l.r(a),l.d(a,{default:()=>he});var t=l(3673),o=l(7786),n=l(2323),i=l(1959),u=l(6665),c=l(4417),s=l(5826),r=l(1289),d=l(4826),p=l(4913),m=l(4842),f=l(8825),v=l(8251),h=l(3787),b=l(765),y=l(1214),w=l(7536);class g{constructor({id:e,detalles:a,fecha:l,fechaVencimiento:t,tipoPago:o,total:n,clienteID:i,clienteNombre:u,costoTotal:c,totalItems:s,totalServicios:r}){this.id=e||"",this.detalles=a||[],this.fecha=l||(0,w.l)(),this.fechaVencimiento=t||(0,w.l)(),this.clienteID=i||"",this.clienteNombre=u||"",this.tipoPago=o||"",this.total=n||0,this.costoTotal=c||0,this.totalItems=s||0,this.totalServicios=r||0}}var I=l(1185),Z=l(852),_=l(7831),V=l(2946);const U=(0,V.r)(),W=(0,_.Q_)("factura",{state:()=>({facturasByID:{}}),getters:{},actions:{validateDevolucion(e){const a=[];return""==e.clienteID&&a.push("Debe seleccionar un cliente"),""==e.tipoPago&&a.push("Debe seleccionar un tipo de pago"),a.length>0||e.detalles.forEach((e=>{const l=U.get(e.codigo);l&&e.cantidad>l.cantidad&&a.push(`No hay suficiente ${l.descripcion}, quedan ${l.cantidad}${l.unidadPreferida}`)})),a},registerFactura(e){this.facturasByID[e.id]=e,e.detalles.forEach((e=>{U.affect(e.codigo,(a=>{if(a)return a.cantidad-=e.cantidad,a.costeTotal-=a.costeUnitario*e.cantidad,a}))}))},findByID(e){return[this.facturasByID[e]]},findByCliente(e){return Object.values(this.facturasByID).filter((a=>a.clienteID.startsWith(e)))},findByFecha(e){return Object.values(this.facturasByID).filter((a=>a.fecha==e))}},persist:!0});var k=l(1186),D=l(8344);const N=e=>((0,t.dD)("data-v-72f09fa0"),e=e(),(0,t.Cn)(),e),S={class:"row items-center"},C=N((()=>(0,t._)("span",{class:"titulo-pagina"},"Factura de venta",-1))),M={class:"comprobante"},T=N((()=>(0,t._)("br",null,null,-1))),q=N((()=>(0,t._)("br",null,null,-1))),E=N((()=>(0,t._)("br",null,null,-1))),B={class:"col-auto row items-end justify-end relative-position"},P={class:"col-auto q-pa-sm item-bordered shadow-2 total"},Q=N((()=>(0,t._)("br",null,null,-1))),R={class:"row items-center justify-end"},H={class:"row items-center justify-end"},j=N((()=>(0,t._)("br",null,null,-1))),$=N((()=>(0,t._)("br",null,null,-1))),x={class:"shadow-2 total bg-white full-width text-center"},F=(0,t.aZ)({emits:["facturaCreada"],setup(e,{emit:a}){const l=(0,f.Z)(),o=(0,i.iH)(0),w=(0,i.iH)(null),_=W(),V=(0,i.iH)(new g({id:(0,I.Z)()})),U=(0,i.iH)([{label:"",value:""}]),N=(0,i.iH)(""),F=[{field:"item",label:"Item",type:b.N.STRING},{field:"codigo",label:"Codigo",type:b.N.NUMBER},{field:"precio",label:"Precio",responsive:!0,type:b.N.NUMBER,formatter:h.M,prefix:"$"},{field:"descuento",label:"Descuento",type:b.N.NUMBER},{field:"impuesto",label:"Impuesto",type:b.N.NUMBER,formatter:e=>`${e}%`},{field:"cantidad",label:"Cantidad",responsive:!0,type:b.N.NUMBER,formatter:h.M},{field:"total",label:"Total",type:b.N.NUMBER,formatter:h.M,prefix:"$"}],O=(0,i.iH)(new y.f({})),Y=(0,i.iH)("ITEM");function z(){l.dialog({component:p.Z}).onOk((e=>{switch(O.value=e,Y.value=e.type,e.type){case"ITEM":U.value=Object.entries(v.M.instance().getUnits(e.dimension)).map((e=>({label:e[1].symbol,value:e[0]})));const a=v.M.instance().dimensions[e.dimension].baseUnit;N.value=v.M.instance().getUnits(e.dimension)[a].symbol;break}setTimeout((()=>{w.value.focus(),w.value.select()}),100)}))}function G(){l.dialog({component:Z.Z}).onOk((e=>{e.clienteID?V.value.clienteID=e.clienteID:V.value.clienteID=e.proveedorID,V.value.clienteNombre=e.nombre}))}const A=(0,i.iH)(0),L=(0,i.iH)(0),J=(0,i.iH)("%");function K(){let e="0%",a=O.value.precio*A.value;if(0!==L.value&&("%"===J.value?(a-=a*(L.value/100),e=`${L.value}%`):(a-=L.value,e=`$${L.value}`)),"ITEM"===O.value.type){let l=O.value;V.value.detalles.push({codigo:l.codigo,item:l.descripcion,impuesto:l.impuesto,precio:l.precio,costo:l.costeUnitario,descuento:e,cantidad:A.value,total:a,costoTotal:l.costeUnitario*A.value,type:"ITEM"})}else{let l=O.value;V.value.detalles.push({codigo:l.codigo,item:l.descripcion,impuesto:l.impuesto,precio:l.precio,costo:0,descuento:e,cantidad:A.value,total:a,costoTotal:0,type:"SERVICIO"})}O.value=new y.f({}),A.value=0,L.value=0}const X=(0,t.Fl)((()=>{let e=0;return V.value.detalles.forEach((a=>{e+=a.total})),e})),ee=(0,i.iH)(!0);function ae(e){ee.value=e.isIntersecting}const le=(0,i.iH)("");function te(){V.value=new g({}),O.value=new y.f({}),A.value=0,L.value=0,le.value=""}function oe(){let e=0,t=0,o=0;for(const a of V.value.detalles)switch(e+=a.costoTotal?a.costoTotal:0,a.type){case"ITEM":t+=a.total;break;case"SERVICIO":o+=a.total;break}V.value.costoTotal=e,V.value.total=X.value,V.value.totalItems=t,V.value.totalServicios=o,a("facturaCreada",V.value);const n=_.validateDevolucion(V.value);if(n.length>0)n.forEach((e=>{l.notify(e)}));else try{_.registerFactura(V.value);D.Q.post("/factura",V.value);V.value=new g({id:(0,I.Z)()}),l.notify("Factura guardada exitosamente")}catch(i){console.log(i)}}return(e,a)=>{const p=(0,t.up)("q-space"),f=(0,t.up)("q-select"),v=(0,t.up)("q-btn"),b=(0,t.up)("q-resize-observer"),y=(0,t.up)("q-date"),g=(0,t.up)("q-popup-proxy"),I=(0,t.up)("q-icon"),Z=(0,t.up)("q-card-section"),_=(0,t.up)("q-card"),W=(0,t.up)("q-page-sticky"),D=(0,t.Q2)("intersection"),le=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(_,{flat:""},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{style:(0,n.j5)({"padding-bottom":o.value+"px"})},{default:(0,t.w5)((()=>[(0,t._)("div",S,[C,(0,t.Wm)(p),(0,t._)("span",M,"ID Factura: "+(0,n.zw)(V.value.id),1)]),T,(0,t.Wm)(c.Z,null,{action:(0,t.w5)((()=>[(0,t.Wm)(k.Z,{"help-key":"factura:agregarItem"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{class:"advance-btn",label:"Agregar item",onClick:K})])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(d.Z,{"help-key":"factura:item"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{modelValue:O.value.descripcion,"onUpdate:modelValue":a[0]||(a[0]=e=>O.value.descripcion=e),label:"Item",readonly:"",onClick:z},null,8,["modelValue"])])),_:1}),(0,t.Wm)(d.Z,{"help-key":"factura:cantidad"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{ref_key:"cantidadHTML",ref:w,modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=e=>A.value=e),modelModifiers:{number:!0},label:"Cantidad",placeholder:"Ingrese cantidad",type:"number"},{append:(0,t.w5)((()=>["ITEM"==Y.value?((0,t.wg)(),(0,t.j4)(f,{key:0,modelValue:N.value,"onUpdate:modelValue":a[1]||(a[1]=e=>N.value=e),options:U.value,"emit-value":"","map-options":""},null,8,["modelValue","options"])):(0,t.kq)("",!0)])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(d.Z,{"help-key":"factura:descuento"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{modelValue:L.value,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value=e),label:"Descuento",placeholder:"Ingrese descuento"},{append:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:J.value,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value=e),options:["%","$"]},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),q,(0,t.Wm)(r.Z,{actions:[{icon:"delete",onClick:(e,a)=>{V.value.detalles.splice(a,1)},class:"revert-btn"}],data:V.value.detalles,schema:F,title:"Items"},null,8,["actions","data"]),E,(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",B,[(0,i.SU)(l).platform.is.mobile?((0,t.wg)(),(0,t.j4)(b,{key:0,onResize:a[5]||(a[5]=({height:e})=>{o.value=e})})):(0,t.kq)("",!0),(0,t._)("span",P,[(0,t._)("b",null,"Total factura: $"+(0,n.zw)((0,i.SU)(h.M)((0,i.SU)(X))),1)])])),[[D,ae]]),Q,(0,t.Wm)(c.Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d.Z,{"help-key":"factura:fecha"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{modelValue:V.value.fecha,"onUpdate:modelValue":a[7]||(a[7]=e=>V.value.fecha=e),label:"Fecha"},{append:(0,t.w5)((()=>[(0,t.Wm)(I,{class:"cursor-pointer",name:"event"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{ref:"qDateProxy",cover:"","transition-hide":"scale","transition-show":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:V.value.fecha,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value.fecha=e),mask:"DD/MM/YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",R,[(0,t.wy)((0,t.Wm)(v,{color:"primary",flat:"",label:"Close"},null,512),[[le]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(d.Z,{"help-key":"factura:fechaVencimiento"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{modelValue:V.value.fechaVencimiento,"onUpdate:modelValue":a[9]||(a[9]=e=>V.value.fechaVencimiento=e),label:"Fecha Vencimiento"},{append:(0,t.w5)((()=>[(0,t.Wm)(I,{class:"cursor-pointer",name:"event"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{ref:"qDateProxy",cover:"","transition-hide":"scale","transition-show":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:V.value.fechaVencimiento,"onUpdate:modelValue":a[8]||(a[8]=e=>V.value.fechaVencimiento=e),mask:"DD/MM/YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",H,[(0,t.wy)((0,t.Wm)(v,{color:"primary",flat:"",label:"Close"},null,512),[[le]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),j,(0,t.Wm)(c.Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d.Z,{"help-key":"factura:terceroID"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{label:"Nit/CC",modelValue:V.value.clienteID,"onUpdate:modelValue":a[10]||(a[10]=e=>V.value.clienteID=e),readonly:"",onClick:G},null,8,["modelValue"])])),_:1}),(0,t.Wm)(d.Z,{"help-key":"factura:nombre"},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(m.Z),{label:"Nombre",modelValue:V.value.clienteNombre,"onUpdate:modelValue":a[11]||(a[11]=e=>V.value.clienteNombre=e),readonly:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(d.Z,{"help-key":"factura:tipoPago"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{label:"Tipo Pago",modelValue:V.value.tipoPago,"onUpdate:modelValue":a[12]||(a[12]=e=>V.value.tipoPago=e),options:["Efectivo","Credito"]},null,8,["modelValue"])])),_:1})])),_:1}),$,(0,t.Wm)(s.Z,{btns:[{label:"Cancelar",fn:()=>{(0,i.SU)(l).dialog({component:u.Z,componentProps:{mensaje:"Â¿Seguro que quieres cancelar?"}}).onOk((a=>{e.x,(0,i.SU)(l).notify("Factura cancelada"),te()})).onCancel((()=>{(0,i.SU)(l).notify("Cancelado")}))},class:"revert-btn shadow-10"},{label:"Guardar",fn:oe}]},null,8,["btns"])])),_:1},8,["style"])])),_:1}),ee.value?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(W,{key:0,expand:"",position:"bottom"},{default:(0,t.w5)((()=>[(0,t._)("span",x,[(0,t._)("b",null,"Total factura: $"+(0,n.zw)((0,i.SU)(h.M)((0,i.SU)(X))),1)])])),_:1}))],64)}}});var O=l(4260),Y=l(151),z=l(5589),G=l(2025),A=l(3017),L=l(8240),J=l(5151),K=l(4554),X=l(3944),ee=l(6915),ae=l(1007),le=l(5094),te=l(677),oe=l(7518),ne=l.n(oe);const ie=(0,O.Z)(F,[["__scopeId","data-v-72f09fa0"]]),ue=ie;ne()(F,"components",{QCard:Y.Z,QCardSection:z.Z,QSpace:G.Z,QInput:m.Z,QSelect:A.Z,QBtn:L.Z,QResizeObserver:J.Z,QIcon:K.Z,QPopupProxy:X.Z,QDate:ee.Z,QPageSticky:ae.Z}),ne()(F,"directives",{Intersection:le.Z,ClosePopup:te.Z});var ce=l(5946),se=l(1716);const re=(0,t.aZ)({setup(e){const a=W(),l=(0,i.iH)(void 0);function o(e){l.value=e}const n=[{field:"id",label:"ID",responsive:!0,type:b.N.STRING},{field:"fecha",label:"Fecha",responsive:!0,type:b.N.STRING},{field:"clienteID",label:"Nit/CC",responsive:!0,type:b.N.STRING},{field:"tipoPago",label:"Tipo de pago",responsive:!0,type:b.N.STRING},{field:"total",label:"Total",responsive:!0,type:b.N.NUMBER,formatter:h.M,prefix:"$"}];return(e,u)=>((0,t.wg)(),(0,t.j4)(se.Z,{store:(0,i.SU)(a),schema:n,onSelected:o},{default:(0,t.w5)((()=>[l.value?((0,t.wg)(),(0,t.j4)(ce.Z,{key:0,factura:l.value},null,8,["factura"])):(0,t.kq)("",!0)])),_:1},8,["store"]))}}),de=(0,O.Z)(re,[["__scopeId","data-v-3aa5cdfe"]]),pe=de,me=(0,t.aZ)({setup(e){return(e,a)=>{const l=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(l,null,{default:(0,t.w5)((()=>[(0,t.Wm)(o.Z,{tabs:["Crear","Buscar"]},{Crear:(0,t.w5)((()=>[(0,t.Wm)(ue)])),Buscar:(0,t.w5)((()=>[(0,t.Wm)(pe)])),_:1})])),_:1})}}});var fe=l(4379);const ve=me,he=ve;ne()(me,"components",{QPage:fe.Z})}}]);